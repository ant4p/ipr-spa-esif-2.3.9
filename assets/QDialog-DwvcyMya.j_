import{J as le,bw as Q,O as u,a1 as f,W as Te,bx as Ee,bj as qe,y as Se,H as M,z as w,C as Le,I as U,bf as Ce,A as x,b0 as J,B as Be}from"./index-Bhl6SETv.js";import{u as He,a as Pe}from"./use-tick-0DdASRGW.js";import{u as _e,a as Fe,b as ze}from"./use-model-toggle-DypRWqPB.js";import{b as Me,a as De,w as $e,u as Oe,h as Ve,k as Ae,d as Ke}from"./position-engine-CD8Qv4MV.js";function Re(e,t,s){let i;function r(){i!==void 0&&(Q.remove(i),i=void 0)}return le(()=>{e.value===!0&&r()}),{removeFromHistory:r,addToHistory(){i={condition:()=>s.value===!0,handler:t},Q.add(i)}}}let k=0,D,$,T,O=!1,G,N,Z,m=null;function We(e){Ie(e)&&Te(e)}function Ie(e){if(e.target===document.body||e.target.classList.contains("q-layout__backdrop"))return!0;const t=Ee(e),s=e.shiftKey&&!e.deltaX,i=!s&&Math.abs(e.deltaX)<=Math.abs(e.deltaY),r=s||i?e.deltaY:e.deltaX;for(let a=0;a<t.length;a++){const n=t[a];if($e(n,i))return i?r<0&&n.scrollTop===0?!0:r>0&&n.scrollTop+n.clientHeight===n.scrollHeight:r<0&&n.scrollLeft===0?!0:r>0&&n.scrollLeft+n.clientWidth===n.scrollWidth}return!0}function ee(e){e.target===document&&(document.scrollingElement.scrollTop=document.scrollingElement.scrollTop)}function L(e){O!==!0&&(O=!0,requestAnimationFrame(()=>{O=!1;const{height:t}=e.target,{clientHeight:s,scrollTop:i}=document.scrollingElement;(T===void 0||t!==window.innerHeight)&&(T=s-t,document.scrollingElement.scrollTop=i),i>T&&(document.scrollingElement.scrollTop-=Math.ceil((i-T)/8))}))}function te(e){const t=document.body,s=window.visualViewport!==void 0;if(e==="add"){const{overflowY:i,overflowX:r}=window.getComputedStyle(t);D=Me(window),$=De(window),G=t.style.left,N=t.style.top,Z=window.location.href,t.style.left=`-${D}px`,t.style.top=`-${$}px`,r!=="hidden"&&(r==="scroll"||t.scrollWidth>window.innerWidth)&&t.classList.add("q-body--force-scrollbar-x"),i!=="hidden"&&(i==="scroll"||t.scrollHeight>window.innerHeight)&&t.classList.add("q-body--force-scrollbar-y"),t.classList.add("q-body--prevent-scroll"),document.qScrollPrevented=!0,u.is.ios===!0&&(s===!0?(window.scrollTo(0,0),window.visualViewport.addEventListener("resize",L,f.passiveCapture),window.visualViewport.addEventListener("scroll",L,f.passiveCapture),window.scrollTo(0,0)):window.addEventListener("scroll",ee,f.passiveCapture))}u.is.desktop===!0&&u.is.mac===!0&&window[`${e}EventListener`]("wheel",We,f.notPassive),e==="remove"&&(u.is.ios===!0&&(s===!0?(window.visualViewport.removeEventListener("resize",L,f.passiveCapture),window.visualViewport.removeEventListener("scroll",L,f.passiveCapture)):window.removeEventListener("scroll",ee,f.passiveCapture)),t.classList.remove("q-body--prevent-scroll"),t.classList.remove("q-body--force-scrollbar-x"),t.classList.remove("q-body--force-scrollbar-y"),document.qScrollPrevented=!1,t.style.left=G,t.style.top=N,window.location.href===Z&&window.scrollTo(D,$),T=void 0)}function Xe(e){let t="add";if(e===!0){if(k++,m!==null){clearTimeout(m),m=null;return}if(k>1)return}else{if(k===0||(k--,k>0))return;if(t="remove",u.is.ios===!0&&u.is.nativeMobile===!0){m!==null&&clearTimeout(m),m=setTimeout(()=>{te(t),m=null},100);return}}te(t)}function Ye(){let e;return{preventBodyScroll(t){t!==e&&(e!==void 0||t===!0)&&(e=t,Xe(t))}}}const v=[];let y;function je(e){y=e.keyCode===27}function Qe(){y===!0&&(y=!1)}function Ue(e){y===!0&&(y=!1,qe(e,27)===!0&&v[v.length-1](e))}function se(e){window[e]("keydown",je),window[e]("blur",Qe),window[e]("keyup",Ue),y=!1}function Je(e){u.is.desktop===!0&&(v.push(e),v.length===1&&se("addEventListener"))}function oe(e){const t=v.indexOf(e);t!==-1&&(v.splice(t,1),v.length===0&&se("removeEventListener"))}const h=[];function re(e){h[h.length-1](e)}function Ge(e){u.is.desktop===!0&&(h.push(e),h.length===1&&document.body.addEventListener("focusin",re))}function ie(e){const t=h.indexOf(e);t!==-1&&(h.splice(t,1),h.length===0&&document.body.removeEventListener("focusin",re))}let C=0;const Ne={standard:"fixed-full flex-center",top:"fixed-top justify-center",bottom:"fixed-bottom justify-center",right:"fixed-right items-center",left:"fixed-left items-center"},ne={standard:["scale","scale"],top:["slide-down","slide-up"],bottom:["slide-up","slide-down"],right:["slide-left","slide-right"],left:["slide-right","slide-left"]},it=Se({name:"QDialog",inheritAttrs:!1,props:{...Fe,...Oe,transitionShow:String,transitionHide:String,persistent:Boolean,autoClose:Boolean,allowFocusOutside:Boolean,noEscDismiss:Boolean,noBackdropDismiss:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,noShake:Boolean,seamless:Boolean,maximized:Boolean,fullWidth:Boolean,fullHeight:Boolean,square:Boolean,backdropFilter:String,position:{type:String,default:"standard",validator:e=>["standard","top","bottom","left","right"].includes(e)}},emits:[..._e,"shake","click","escapeKey"],setup(e,{slots:t,emit:s,attrs:i}){const r=Le(),a=M(null),n=M(!1),p=M(!1);let c=null,d=null,E,B;const V=w(()=>e.persistent!==!0&&e.noRouteDismiss!==!0&&e.seamless!==!0),{preventBodyScroll:A}=Ye(),{registerTimeout:K}=He(),{registerTick:ae,removeTick:R}=Pe(),{transitionProps:ue,transitionStyle:W}=Ve(e,()=>ne[e.position][0],()=>ne[e.position][1]),ce=w(()=>W.value+(e.backdropFilter!==void 0?`;backdrop-filter:${e.backdropFilter};-webkit-backdrop-filter:${e.backdropFilter}`:"")),{showPortal:I,hidePortal:X,portalIsAccessible:de,renderPortal:fe}=Ae(r,a,ke,"dialog"),{hide:q}=ze({showing:n,hideOnRouteChange:V,handleShow:ye,handleHide:pe,processOnMount:!0}),{addToHistory:me,removeFromHistory:ve}=Re(n,q,V),he=w(()=>`q-dialog__inner flex no-pointer-events q-dialog__inner--${e.maximized===!0?"maximized":"minimized"} q-dialog__inner--${e.position} ${Ne[e.position]}`+(p.value===!0?" q-dialog__inner--animating":"")+(e.fullWidth===!0?" q-dialog__inner--fullwidth":"")+(e.fullHeight===!0?" q-dialog__inner--fullheight":"")+(e.square===!0?" q-dialog__inner--square":"")),S=w(()=>n.value===!0&&e.seamless!==!0),ge=w(()=>e.autoClose===!0?{onClick:be}:{}),we=w(()=>[`q-dialog fullscreen no-pointer-events q-dialog--${S.value===!0?"modal":"seamless"}`,i.class]);U(()=>e.maximized,o=>{n.value===!0&&_(o)}),U(S,o=>{A(o),o===!0?(Ge(F),Je(P)):(ie(F),oe(P))});function ye(o){me(),d=e.noRefocus===!1&&document.activeElement!==null?document.activeElement:null,_(e.maximized),I(),p.value=!0,e.noFocus!==!0?(document.activeElement?.blur(),ae(b)):R(),K(()=>{if(r.proxy.$q.platform.is.ios===!0){if(e.seamless!==!0&&document.activeElement){const{top:l,bottom:g}=document.activeElement.getBoundingClientRect(),{innerHeight:j}=window,z=window.visualViewport!==void 0?window.visualViewport.height:j;l>0&&g>z/2&&(document.scrollingElement.scrollTop=Math.min(document.scrollingElement.scrollHeight-z,g>=j?1/0:Math.ceil(document.scrollingElement.scrollTop+g-z/2))),document.activeElement.scrollIntoView()}B=!0,a.value.click(),B=!1}I(!0),p.value=!1,s("show",o)},e.transitionDuration)}function pe(o){R(),ve(),Y(!0),p.value=!0,X(),d!==null&&(((o?.type.indexOf("key")===0?d.closest('[tabindex]:not([tabindex^="-"])'):void 0)||d).focus(),d=null),K(()=>{X(!0),p.value=!1,s("hide",o)},e.transitionDuration)}function b(o){Ke(()=>{let l=a.value;if(l!==null){if(o!==void 0){const g=l.querySelector(o);if(g!==null){g.focus({preventScroll:!0});return}}l.contains(document.activeElement)!==!0&&(l=l.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||l.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||l.querySelector("[autofocus], [data-autofocus]")||l,l.focus({preventScroll:!0}))}})}function H(o){o&&typeof o.focus=="function"?o.focus({preventScroll:!0}):b(),s("shake");const l=a.value;l!==null&&(l.classList.remove("q-animate--scale"),l.classList.add("q-animate--scale"),c!==null&&clearTimeout(c),c=setTimeout(()=>{c=null,a.value!==null&&(l.classList.remove("q-animate--scale"),b())},170))}function P(){e.seamless!==!0&&(e.persistent===!0||e.noEscDismiss===!0?e.maximized!==!0&&e.noShake!==!0&&H():(s("escapeKey"),q()))}function Y(o){c!==null&&(clearTimeout(c),c=null),(o===!0||n.value===!0)&&(_(!1),e.seamless!==!0&&(A(!1),ie(F),oe(P))),o!==!0&&(d=null)}function _(o){o===!0?E!==!0&&(C<1&&document.body.classList.add("q-body--dialog"),C++,E=!0):E===!0&&(C<2&&document.body.classList.remove("q-body--dialog"),C--,E=!1)}function be(o){B!==!0&&(q(o),s("click",o))}function xe(o){e.persistent!==!0&&e.noBackdropDismiss!==!0?q(o):e.noShake!==!0&&H()}function F(o){e.allowFocusOutside!==!0&&de.value===!0&&Ce(a.value,o.target)!==!0&&b('[tabindex]:not([tabindex="-1"])')}Object.assign(r.proxy,{focus:b,shake:H,__updateRefocusTarget(o){d=o||null}}),le(Y);function ke(){return x("div",{role:"dialog","aria-modal":S.value===!0?"true":"false",...i,class:we.value},[x(J,{name:"q-transition--fade",appear:!0},()=>S.value===!0?x("div",{class:"q-dialog__backdrop fixed-full",style:ce.value,"aria-hidden":"true",tabindex:-1,onClick:xe}):null),x(J,ue.value,()=>n.value===!0?x("div",{ref:a,class:he.value,style:W.value,tabindex:-1,...ge.value},Be(t.default)):null)])}return fe}});export{it as Q,Ye as a,Ge as b,Je as c,oe as d,ie as r,Re as u};
