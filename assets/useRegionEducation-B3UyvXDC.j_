import{H as s,z as c,bE as i}from"./index-Bhl6SETv.js";const E=20,o=new Map;function y(){const r=s({geo:!1,detailed:!1}),l=s(null),n=s([]),h=c(()=>{const e=i.chain(n.value).groupBy("region_iso").mapValues(t=>({id:t[0]?.region_iso??"",total:t.length,heatValue:Math.pow(t.length,.2),vo:t.filter(a=>a.type==="vo").length,dpo:t.filter(a=>a.type==="dpo").length,mixed:t.filter(a=>a.type==="mixed").length})).value();return{byRegion:e,asList:Object.values(e)}}),p=c(()=>n.value.map(e=>({geometry:{type:"Point",coordinates:[e.lon,e.lat]},title:e.name,address:e.addr,type:e.type,region_iso:e.region_iso,vo:e.vo,dpo:e.dpo}))),f=e=>e.reduce((t,a)=>(t.total+=a.vo.length+a.dpo.length,t.vo+=a.vo.length,t.dpo+=a.dpo.length,t.mixed+=a.vo.length&&a.dpo.length?a.vo.length+a.dpo.length:0,t),{total:0,vo:0,dpo:0,mixed:0}),v=async()=>{if(n.value.length)return n.value;r.value.geo=!0,l.value=null;try{const e=await fetch("data/edu_map_data.json");if(!e.ok)throw new Error("Не удалось получить данные карты");const t=await e.json();return n.value=t,t}catch(e){return l.value=e instanceof Error?e.message:"Неизвестная ошибка",console.error("Не удалось получить данные карты:",e),[]}finally{r.value.geo=!1}},g=async e=>{if(o.has(e))return o.get(e);if(o.size>=E){const t=o.keys().next().value;t&&o.delete(t)}r.value.detailed=!0,l.value=null;try{const t=await fetch("data/edu_region_data.json");if(!t.ok)throw new Error("Не удалось получить данные региона");const u=(await t.json())[e];if(!u)throw new Error("Данные региона не найдены");const d=i.chain(u).sortBy("name").value();return o.set(e,d),d}catch(t){return l.value=t instanceof Error?t.message:"Неизвестная ошибка",console.error("Failed to fetch region data:",t),[]}finally{r.value.detailed=!1}};function m(){o.clear()}return{loading:r,error:l,geoEntities:n,stats:h,bulletData:p,statsByRegion:f,fetchEducationGeoData:v,fetchEducationRegionData:g,clearCache:m}}export{y as u};
